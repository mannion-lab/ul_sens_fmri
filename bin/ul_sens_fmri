#! /usr/bin/env python2

import sys
import argparse

import runcmd


conf = ul_sens.config.get_conf()


def run_prep_images(args):
    ul_sens.exp.prep_images(conf)


def run_prep_subj(args):
    ul_sens.exp.prep_subj(conf, args.subj_id)


def run_exp(args):

    run_range = range(
        args.start_run,
        args.end_run + 1
    )

    for run_num in run_range:
        ul_sens.exp.run(conf, args.subj_id, run_num)

def subj_summ(args):
    ul_sens.summary.subj_summ(conf=conf, subj_id=args.subj_id)

def instruct(args):
    ul_sens.instruct.instruct(conf)


parser = argparse.ArgumentParser()

subparsers = parser.add_subparsers(help="")

prep_parser = subparsers.add_parser("prep_images")
prep_parser.set_defaults(func=run_prep_images)

subj_parser = subparsers.add_parser("prep_subj")
subj_parser.add_argument("subj_id", help="Subject ID")
subj_parser.set_defaults(func=run_prep_subj)

exp_parser = subparsers.add_parser("exp")
exp_parser.add_argument("subj_id", help="Subject ID")
exp_parser.add_argument("--start_run", help="Start run", type=int, default=1)
exp_parser.add_argument(
    "--end_run",
    help="End run",
    type=int,
    default=conf.n_runs
)
exp_parser.set_defaults(func=run_exp)

summ_parser = subparsers.add_parser("summary")
summ_parser.add_argument("subj_id", help="Subject ID")
summ_parser.set_defaults(func=subj_summ)

instruct_parser = subparsers.add_parser("instruct")
instruct_parser.set_defaults(func=instruct)

args = parser.parse_args()

args.func(args)
